@using KaylaBugTracker.Helpers
@using Microsoft.AspNet.Identity
@model IEnumerable<KaylaBugTracker.Models.Project>

@{
	ViewBag.Title = "Index";
	var projectHelper = new ProjectHelper();
}

<div class="main-panel">
	<div class="content-wrapper">
		<div class="card">
			<div class="card-header text-center">
				<h2>All Projects</h2>
			</div>			
			<div class="card-body">
				@if (User.IsInRole("Admin") || User.IsInRole("Project Manager"))
				{
					<div class="card border-0">
						<div class="card-header bg-success text-center">
							<h2 class="projectDetails">All Projects</h2>
						</div>
						<div class="card-body">
							<div class="table-responsive">
								<table id="myTable" class="table table-hover table-striped table-borderless">
									<thead>
										<tr>
											<th>
												@Html.DisplayNameFor(model => model.Name)
											</th>
											<th>
												@Html.DisplayNameFor(model => model.Created)
											</th>
											<th>
												Open Tickets
											</th>
											<th>
												@Html.DisplayName("Archived")
											</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										@foreach (var item in Model)
										{
											<tr>
												<td>
													@Html.DisplayFor(modelItem => item.Name)
												</td>
												<td>
													@Html.DisplayFor(modelItem => item.Created)
												</td>
												<td>
													@projectHelper.totalOpenTickets(item.Id)
												</td>
												<td>
													@Html.DisplayFor(modelItem => item.IsArchived)
												</td>
												<td>
													@Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
													@Html.ActionLink("Details", "Details", new { id = item.Id })
												</td>
											</tr>
										}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="card border-0">
						<div class="card-header bg-success text-center">
							<h2 class="projectDetails">My Projects</h2>
						</div>
						<div class="card-body">
							<div class="table-responsive">
								<table id="myTable2" class="table table-hover table-striped table-borderless">
									<thead>
										<tr>
											<th>
												@Html.DisplayNameFor(model => model.Name)
											</th>
											<th>
												Tickets on Project
											</th>
											<th>
												@Html.DisplayNameFor(model => model.Created)
											</th>
											<th>
												@Html.DisplayNameFor(model => model.IsArchived)
											</th>
											<th>
												Action
											</th>
										</tr>
									</thead>
									<tbody>
										@foreach (var item in projectHelper.ListUserProjects(User.Identity.GetUserId()))
										{
											<tr>
												<td>
													@Html.DisplayFor(modelItem => item.Name)
												</td>
												<td>
													@Html.DisplayFor(modelItem => item.Tickets.Count)
												</td>
												<td>
													@Html.DisplayFor(modelItem => item.Created)
												</td>
												<td>
													@Html.DisplayFor(modelItem => item.IsArchived)
												</td>
												<td>
													@Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
													@Html.ActionLink("Details", "Details", new { id = item.Id })
												</td>
											</tr>
										}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				}
			</div>
		</div>
	</div>
</div>